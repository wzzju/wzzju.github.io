---
layout: post
title: 终极vimrc的配置与使用技巧
date: 2022-03-03
comments: true
toc: true
categories: [ "VIM" ]
---

> VIM是远程开发场景中必不可少的编辑器，[amix/vimrc](https://github.com/amix/vimrc)提供了一些有用的配置，本文对其安装及使用技巧进行记录。

## 安装vimrc
使用如下命令进行安装:

```shell
git clone --depth=1 https://github.com/amix/vimrc.git ~/.vim_runtime
sh ~/.vim_runtime/install_awesome_vimrc.sh
```

为使用ACK插件，完成上面安装命令后，需要在系统中安装`ack-grep`工具，Ubuntu系统的安装命令如下：
```shell
sudo apt install ack-grep
```
若使用ACK插件时遇到一些warning信息，可尝试设置如下环境变量：
```shell
export LC_ALL=en_US.UTF-8
```

## 定制VIM配置

可以创建`vim ~/.vim_runtime/my_configs.vim`文件，并在该文件中添加自己的偏好设置。本人对`undofile`、`backup`和`swapfile`等进行了一些配置。在`my_configs.vim`文件中添加如下内容前，请确保在`~/.vim_runtime/temp_dirs`目录下存在`undodir`、`backupdir`以及`swapdir`三个文件夹。

```shell
set number

set undofile
" mkdir -p ~/.vim_runtime/temp_dirs/undodir
set undodir=~/.vim_runtime/temp_dirs/undodir
" Maximum number of changes that can be undone
set undolevels=1000
" Maximum number lines to save for undo on a buffer reload
set undoreload=10000

set backup
" mkdir -p ~/.vim_runtime/temp_dirs/backupdir
set backupdir=~/.vim_runtime/temp_dirs/backupdir
"Make backup before overwriting the current buffer
set writebackup
"Overwrite the original backup file
set backupcopy=yes
"Meaningful backup name, ex: filename@2015-04-05.14:59
au BufWritePre * let &bex = '@' . strftime("%F.%H:%M")

set swapfile
" mkdir -p ~/.vim_runtime/temp_dirs/swapdir
set directory=~/.vim_runtime/temp_dirs/swapdir

" Better Unix / Windows compatibility
set viewoptions=folds,options,cursor,unix,slash
```

## vimrc常用命令介绍

> `amix/vimrc`中的前缀键(Leader Key)是`,`。

### 1. 标签操作(tab)
* `gt`：跳转到后一个标签
* `gT`：跳转到前一个标签
* `num + gt`：跳转到第num个标签
* `,tl`：跳转到上一次的标签
* `,te`：新建标签，并打开当前工作目录
* `,tn`：新建空白标签
* `,tc`：关闭标签
* `,tm`：输入标签号，跳转到对应的标签
* `,to`：仅显示当前一个标签

### 2. 窗口操作
* `:q`/`ctrl + w + q`：关闭窗口
* `ctrl + w + w`：切换窗口
* * `ctrl + j/k/h/l`：在上/下/左/右方向切换窗口
* `:sp `：竖直方向上拆分当前窗口
* `:vsp`：水平方向上拆分当前窗口

### 3. NERDTree目录树
* `,nn`：打开目录树
* `,nn`：关闭目录树

### 4. 文件搜索
* `,j`/`ctrl + f`：打开**当前工作目录下全局文件**搜索面板（基于`ctrlp`插件）。按`esc`键可退出全局文件搜索面板。
* `,f`：打开**最近编辑的文件**搜索面板。按`q`键可退出面板。

### 5. 全局字段搜索
* `,g`：打开**当前工作目录下全局字段**搜索面板（基于`ack`插件），默认大小写敏感，可附加`-i`选项以使用不区分大小写的方式搜索，可附加`-w`选项进行全词匹配。按`q`键可退出搜索面板。

> 在某个目录下直接输入vim命令，则vim将整个目录视为全局工作目录，在进行全局搜索文件或字段时操作的即是该目录。

### 6. 当前文件中搜索
* `*`：按下即可搜索光标所在的单词或当前选中的内容，不区分大小写
* `gd`：将光标移动至单词，按下即可搜索该单词，区分大小写
* `/`：vim自带搜索功能，输入单词向下搜索
* `？`：vim自带搜索功能，输入单词向上搜索

### 7. 取消搜索高亮
* `:noh`：取消搜索高亮

### 8. 显示行修改标志
* `,d`：显示行修改标志，再按一下可关闭显示

### 9. 显示文件路径
* `:f`：显示当前正在编辑的文件路径

### 10. 变量名补全
* `ctrl + n`：自动补全变量名，再次输入匹配下一个

### 11. 代码块补全
用于只需输入部分代码，然后按tab键补全。以`c++`为例：
* `if + tab`：插入`if`分支代码块
* `for + tab`：插入`for`循环代码块
* `switch + tab`：插入`switch`分支代码块
* `fun + tab`：插入函数定义代码块

### 12. 代码注释
* `gcc`：注释当前行，再次输入则撤销当前注释
* `num + gcc`：注释num行
* `gcu`：取消注释，会取消连续的注释行
* `gc`：注释选中部分

### 13. 跳出双引号继续编辑
* `"`：在`"`处输入`"` ，即可将光标跳转至当前双引号之外

### 14. 粘贴0号寄存器的内容
* `ctrl + r + 0`：可将`y`命令复制选中的内容后粘贴到命令输入框

### 15. 文件刷新
* `:e`：重新载入文件内容
* `:e!`：放弃当前修改，强制重新载入
* `:e file_path`：载入路径`file_path`下的某个文件

### 16. 光标停留的位置记录
* `ctrl + o`：将光标跳转到上一个时间点停留的位置
* `ctrl + i`：将光标跳转到下一个时间点停留的位置

### 17. vim对字母进行大小写切换
* `ctrl + v`选中目标单词后，按`~`键可进行大小写转换

### 18. vim翻页
* `ctrl + d`：向下翻页
* `ctrl + u`：向上翻页

### 19. 使用sudo权限保存文件
* `:W`：使用sudo权限将内容写入文件。在打开一个文件需要sudo权限才能保存时，可以使用该命令

### 20. 启动拼写检查
* `,ss`：用于启动拼写错误检查

### 21. 执行代码
* 按`F5`键可执行代码，当前支持C/C++/Java/Python/Go等代码的执行

### 22. vim锁定与解锁
* `ctrl + s`的效果为锁定屏幕，可按`ctrl + q`进行解除

## 参考资料
* [vim 神级配置 vimrc](https://www.jianshu.com/p/e9c6b373b82c)
* [The Ultimate vimrc](https://github.com/amix/vimrc/blob/master/README.md)
