<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="2164.5833px" preserveAspectRatio="none" style="width:919px;height:2164px;background:#00000000;" version="1.1" viewBox="0 0 919 2164" width="919.7917px" zoomAndPan="magnify"><defs/><g><!--MD5=[ee79cccfc377e37c00dfe257dadc9824]
class AlgebraicSimplifierOptions--><rect codeLine="3" height="505.3141" id="AlgebraicSimplifierOptions" rx="4.1667" ry="4.1667" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;fill:none;" width="343.75" x="197.9167" y="1480.2083"/><ellipse cx="285.4167" cy="1497.3724" fill="#EDF0F2" rx="10.4167" ry="10.4167" style="stroke:#BABDBF;stroke-width:1.0416666666666667;"/><path d="M287.3271,1501.7975 Q286.8998,1502.0172 286.4299,1502.1271 Q285.9599,1502.2369 285.4411,1502.2369 Q283.5978,1502.2369 282.6274,1501.0223 Q281.6569,1499.8077 281.6569,1497.5128 Q281.6569,1495.2118 282.6274,1493.9972 Q283.5978,1492.7826 285.4411,1492.7826 Q285.9599,1492.7826 286.436,1492.8925 Q286.912,1493.0023 287.3271,1493.222 L287.3271,1495.224 Q286.8632,1494.7968 286.4268,1494.5984 Q285.9904,1494.4 285.5265,1494.4 Q284.5378,1494.4 284.0342,1495.1843 Q283.5307,1495.9686 283.5307,1497.5128 Q283.5307,1499.0509 284.0342,1499.8352 Q284.5378,1500.6195 285.5265,1500.6195 Q285.9904,1500.6195 286.4268,1500.4211 Q286.8632,1500.2228 287.3271,1499.7955 Z " fill="#000000"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="150" x="310.4167" y="1501.7029">AlgebraicSimplifierOptions</text><line style="stroke:#2FA4E7;stroke-width:1.0416666666666667;" x1="198.9583" x2="540.625" y1="1514.5365" y2="1514.5365"/><rect fill="none" height="6.25" style="stroke:#C82930;stroke-width:1.0416666666666667;" width="6.25" x="206.25" y="1522.8699"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="89.5833" x="222.9167" y="1534.9894">struct_Metadata</text><rect fill="none" height="6.25" style="stroke:#C82930;stroke-width:1.0416666666666667;" width="6.25" x="206.25" y="1546.7814"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="307.2917" x="222.9167" y="1558.901">reshape_is_bitcast_callback_: ReshapeIsBitcastCallback</text><rect fill="none" height="6.25" style="stroke:#C82930;stroke-width:1.0416666666666667;" width="6.25" x="206.25" y="1570.693"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="307.2917" x="222.9167" y="1582.8125">conv_is_lowerable_callback_: ConvIsLowerableCallback</text><rect fill="none" height="6.25" style="stroke:#C82930;stroke-width:1.0416666666666667;" width="6.25" x="206.25" y="1594.6045"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="142.7083" x="222.9167" y="1606.724">is_layout_sensitive_: bool</text><rect fill="none" height="6.25" style="stroke:#C82930;stroke-width:1.0416666666666667;" width="6.25" x="206.25" y="1618.516"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="213.5417" x="222.9167" y="1630.6356">enable_dot_strength_reduction_: bool</text><rect fill="none" height="6.25" style="stroke:#C82930;stroke-width:1.0416666666666667;" width="6.25" x="206.25" y="1642.4276"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="212.5" x="222.9167" y="1654.5471">enable_dot_to_multiply_rewrite_: bool</text><rect fill="none" height="6.25" style="stroke:#C82930;stroke-width:1.0416666666666667;" width="6.25" x="206.25" y="1666.3391"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="188.5417" x="222.9167" y="1678.4587">enable_conv_simplification_: bool</text><rect fill="none" height="6.25" style="stroke:#C82930;stroke-width:1.0416666666666667;" width="6.25" x="206.25" y="1690.2507"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="194.7917" x="222.9167" y="1702.3702">enable_conv_operand_swap_: bool</text><rect fill="none" height="6.25" style="stroke:#C82930;stroke-width:1.0416666666666667;" width="6.25" x="206.25" y="1714.1622"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="225" x="222.9167" y="1726.2817">enable_scalar_multiply_reduction_: bool</text><rect fill="none" height="6.25" style="stroke:#C82930;stroke-width:1.0416666666666667;" width="6.25" x="206.25" y="1738.0737"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="162.5" x="222.9167" y="1750.1933">enable_floats_are_real_: bool</text><rect fill="none" height="6.25" style="stroke:#C82930;stroke-width:1.0416666666666667;" width="6.25" x="206.25" y="1761.9853"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="304.1667" x="222.9167" y="1774.1048">enable_window_reduce_to_reduce_replacement_: bool</text><rect fill="none" height="6.25" style="stroke:#C82930;stroke-width:1.0416666666666667;" width="6.25" x="206.25" y="1785.8968"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="187.5" x="222.9167" y="1798.0164">enable_reduce_of_reshape_: bool</text><rect fill="none" height="6.25" style="stroke:#C82930;stroke-width:1.0416666666666667;" width="6.25" x="206.25" y="1809.8083"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="254.1667" x="222.9167" y="1821.9279">enable_negative_padding_replacement_: bool</text><rect fill="none" height="6.25" style="stroke:#C82930;stroke-width:1.0416666666666667;" width="6.25" x="206.25" y="1833.7199"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="165.625" x="222.9167" y="1845.8394">enable_sink_broadcast_: bool</text><rect fill="none" height="6.25" style="stroke:#C82930;stroke-width:1.0416666666666667;" width="6.25" x="206.25" y="1857.6314"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="213.5417" x="222.9167" y="1869.751">replace_transpose_with_bitcast_: bool</text><rect fill="none" height="6.25" style="stroke:#C82930;stroke-width:1.0416666666666667;" width="6.25" x="206.25" y="1881.543"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="182.2917" x="222.9167" y="1893.6625">very_small_gather_size_: int64_t</text><rect fill="none" height="6.25" style="stroke:#C82930;stroke-width:1.0416666666666667;" width="6.25" x="206.25" y="1905.4545"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="172.9167" x="222.9167" y="1917.5741">minmax_propagate_nan_: bool</text><rect fill="none" height="6.25" style="stroke:#C82930;stroke-width:1.0416666666666667;" width="6.25" x="206.25" y="1929.366"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="113.5417" x="222.9167" y="1941.4856">metadata_: Metadata</text><line style="stroke:#2FA4E7;stroke-width:1.0416666666666667;" x1="198.9583" x2="540.625" y1="1953.2776" y2="1953.2776"/><ellipse cx="209.375" cy="1964.7359" fill="#84BE84" rx="3.125" ry="3.125" style="stroke:#038048;stroke-width:1.0416666666666667;"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="206.25" x="222.9167" y="1973.7305">setter &amp; getter of private fields above</text><!--MD5=[b464d64499d8b416c5119eeca9dec549]
class AlgebraicSimplifierOptions::Metadata--><rect codeLine="25" height="74.9064" id="AlgebraicSimplifierOptions::Metadata" rx="4.1667" ry="4.1667" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;fill:none;" width="360.4167" x="189.5833" y="2078.125"/><ellipse cx="257.2917" cy="2095.2891" fill="#EDF0F2" rx="10.4167" ry="10.4167" style="stroke:#BABDBF;stroke-width:1.0416666666666667;"/><path d="M259.2021,2099.7142 Q258.7748,2099.9339 258.3049,2100.0437 Q257.8349,2100.1536 257.3161,2100.1536 Q255.4728,2100.1536 254.5024,2098.939 Q253.5319,2097.7244 253.5319,2095.4295 Q253.5319,2093.1285 254.5024,2091.9139 Q255.4728,2090.6993 257.3161,2090.6993 Q257.8349,2090.6993 258.311,2090.8091 Q258.787,2090.919 259.2021,2091.1387 L259.2021,2093.1407 Q258.7382,2092.7134 258.3018,2092.5151 Q257.8654,2092.3167 257.4015,2092.3167 Q256.4128,2092.3167 255.9092,2093.101 Q255.4057,2093.8853 255.4057,2095.4295 Q255.4057,2096.9676 255.9092,2097.7519 Q256.4128,2098.5362 257.4015,2098.5362 Q257.8654,2098.5362 258.3018,2098.3378 Q258.7382,2098.1394 259.2021,2097.7122 Z " fill="#000000"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="206.25" x="282.2917" y="2099.6195">AlgebraicSimplifierOptions::Metadata</text><line style="stroke:#2FA4E7;stroke-width:1.0416666666666667;" x1="190.625" x2="548.9583" y1="2112.4532" y2="2112.4532"/><ellipse cx="201.0417" cy="2123.9115" rx="3.125" ry="3.125" style="stroke:#038048;stroke-width:1.0416666666666667;fill:none;"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="323.9583" x="214.5833" y="2132.9061">cudnn_batchnorm_forward_training_metadata: std::string</text><line style="stroke:#2FA4E7;stroke-width:1.0416666666666667;" x1="190.625" x2="548.9583" y1="2144.6981" y2="2144.6981"/><!--MD5=[0f727e651a9f1681443e9658d859fd87]
class AlgebraicSimplifier--><rect codeLine="30" height="146.641" id="AlgebraicSimplifier" rx="4.1667" ry="4.1667" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;fill:none;" width="503.125" x="404.6875" y="1265.625"/><ellipse cx="594.2708" cy="1282.7891" fill="#EDF0F2" rx="10.4167" ry="10.4167" style="stroke:#BABDBF;stroke-width:1.0416666666666667;"/><path d="M596.1812,1287.2142 Q595.754,1287.4339 595.284,1287.5437 Q594.814,1287.6536 594.2952,1287.6536 Q592.452,1287.6536 591.4815,1286.439 Q590.5111,1285.2244 590.5111,1282.9295 Q590.5111,1280.6285 591.4815,1279.4139 Q592.452,1278.1993 594.2952,1278.1993 Q594.814,1278.1993 595.2901,1278.3091 Q595.7662,1278.419 596.1812,1278.6387 L596.1812,1280.6407 Q595.7174,1280.2134 595.281,1280.0151 Q594.8446,1279.8167 594.3807,1279.8167 Q593.3919,1279.8167 592.8884,1280.601 Q592.3848,1281.3853 592.3848,1282.9295 Q592.3848,1284.4676 592.8884,1285.2519 Q593.3919,1286.0362 594.3807,1286.0362 Q594.8446,1286.0362 595.281,1285.8378 Q595.7174,1285.6394 596.1812,1285.2122 Z " fill="#000000"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="105.2083" x="619.2708" y="1287.1195">AlgebraicSimplifier</text><line style="stroke:#2FA4E7;stroke-width:1.0416666666666667;" x1="405.7292" x2="906.7708" y1="1299.9532" y2="1299.9532"/><polygon fill="none" points="416.1458,1306.2032,420.3125,1310.3699,416.1458,1314.5365,411.9792,1310.3699" style="stroke:#B38D22;stroke-width:1.0416666666666667;"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="205.2083" x="429.6875" y="1320.4061">options_: AlgebraicSimplifierOptions</text><line style="stroke:#2FA4E7;stroke-width:1.0416666666666667;" x1="405.7292" x2="906.7708" y1="1332.1981" y2="1332.1981"/><ellipse cx="416.1458" cy="1343.6564" fill="#84BE84" rx="3.125" ry="3.125" style="stroke:#038048;stroke-width:1.0416666666666667;"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="355.2083" x="429.6875" y="1352.651">AlgebraicSimplifier(options: const AlgebraicSimplifierOptions&amp;)</text><ellipse cx="416.1458" cy="1367.568" fill="#84BE84" rx="3.125" ry="3.125" style="stroke:#038048;stroke-width:1.0416666666666667;"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="241.6667" x="429.6875" y="1376.5625">Run(module: HloModule*): StatusOr&lt;bool&gt;</text><text fill="#008080" font-family="&quot;Verdana&quot;" font-size="11.4583" font-weight="bold" lengthAdjust="spacing" textLength="48.9583" x="674.4792" y="1376.5625">override</text><ellipse cx="416.1458" cy="1391.4795" fill="#84BE84" rx="3.125" ry="3.125" style="stroke:#038048;stroke-width:1.0416666666666667;"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="466.6667" x="429.6875" y="1400.474">CreateConstantWithLayoutUpdated(literal: Literal): std::unique_ptr&lt;HloInstruction&gt;</text><!--MD5=[e22db3cdfc2212a25ee9b52de5a4b213]
class DfsHloVisitorBase--><rect codeLine="37" height="50.9949" id="DfsHloVisitorBase" rx="4.1667" ry="4.1667" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;fill:none;" width="140.625" x="299.4792" y="17.7083"/><ellipse cx="314.0625" cy="34.8724" fill="#D2494E" rx="10.4167" ry="10.4167" style="stroke:#FFFFFF;stroke-width:1.0416666666666667;"/><path d="M310.9456,32.0343 L310.9456,30.4474 L316.3717,30.4474 L316.3717,32.0343 L314.5589,32.0343 L314.5589,37.973 L316.3717,37.973 L316.3717,39.5599 L310.9456,39.5599 L310.9456,37.973 L312.7584,37.973 L312.7584,32.0343 Z " fill="#000000"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="11.4583" font-style="italic" lengthAdjust="spacing" textLength="98.9583" x="332.8125" y="39.2029">DfsHloVisitorBase</text><line style="stroke:#2FA4E7;stroke-width:1.0416666666666667;" x1="300.5208" x2="439.0625" y1="52.0365" y2="52.0365"/><line style="stroke:#2FA4E7;stroke-width:1.0416666666666667;" x1="300.5208" x2="439.0625" y1="60.3699" y2="60.3699"/><!--MD5=[e327024629bf60f36927bb55c7d703f5]
class DfsHloVisitorWithDefaultBase--><rect codeLine="53" height="50.9949" id="DfsHloVisitorWithDefaultBase" rx="4.1667" ry="4.1667" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;fill:none;" width="204.1667" x="267.7083" y="132.2917"/><ellipse cx="282.2917" cy="149.4558" fill="#8FB961" rx="10.4167" ry="10.4167" style="stroke:#FFFFFF;stroke-width:1.0416666666666667;"/><path d="M282.4056,146.1578 L281.5572,149.8871 L283.2601,149.8871 Z M281.307,144.5099 L283.5103,144.5099 L285.9701,153.6224 L284.1695,153.6224 L283.608,151.3702 L281.1971,151.3702 L280.6478,153.6224 L278.8472,153.6224 Z " fill="#000000"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="11.4583" font-style="italic" lengthAdjust="spacing" textLength="162.5" x="301.0417" y="153.7862">DfsHloVisitorWithDefaultBase</text><line style="stroke:#2FA4E7;stroke-width:1.0416666666666667;" x1="268.75" x2="470.8333" y1="166.6199" y2="166.6199"/><line style="stroke:#2FA4E7;stroke-width:1.0416666666666667;" x1="268.75" x2="470.8333" y1="174.9532" y2="174.9532"/><!--MD5=[a7b53e3f6267f27b7a4ce77cb159826b]
class DfsHloRewriteVisitor--><rect codeLine="66" height="170.5526" id="DfsHloRewriteVisitor" rx="4.1667" ry="4.1667" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;fill:none;" width="700" x="19.7917" y="246.875"/><ellipse cx="303.125" cy="264.0391" fill="#EDF0F2" rx="10.4167" ry="10.4167" style="stroke:#BABDBF;stroke-width:1.0416666666666667;"/><path d="M305.0354,268.4642 Q304.6082,268.6839 304.1382,268.7937 Q303.6682,268.9036 303.1494,268.9036 Q301.3062,268.9036 300.3357,267.689 Q299.3652,266.4744 299.3652,264.1795 Q299.3652,261.8785 300.3357,260.6639 Q301.3062,259.4493 303.1494,259.4493 Q303.6682,259.4493 304.1443,259.5591 Q304.6204,259.669 305.0354,259.8887 L305.0354,261.8907 Q304.5715,261.4634 304.1351,261.2651 Q303.6987,261.0667 303.2349,261.0667 Q302.2461,261.0667 301.7426,261.851 Q301.239,262.6353 301.239,264.1795 Q301.239,265.7176 301.7426,266.5019 Q302.2461,267.2862 303.2349,267.2862 Q303.6987,267.2862 304.1351,267.0878 Q304.5715,266.8894 305.0354,266.4622 Z " fill="#000000"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="114.5833" x="328.125" y="268.3695">DfsHloRewriteVisitor</text><line style="stroke:#2FA4E7;stroke-width:1.0416666666666667;" x1="20.8333" x2="718.75" y1="281.2032" y2="281.2032"/><polygon fill="none" points="31.25,287.4532,35.4167,291.6199,31.25,295.7865,27.0833,291.6199" style="stroke:#B38D22;stroke-width:1.0416666666666667;"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="85.4167" x="44.7917" y="301.6561">changed_: bool</text><line style="stroke:#2FA4E7;stroke-width:1.0416666666666667;" x1="20.8333" x2="718.75" y1="313.4481" y2="313.4481"/><ellipse cx="31.25" cy="324.9064" fill="#84BE84" rx="3.125" ry="3.125" style="stroke:#038048;stroke-width:1.0416666666666667;"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="298.9583" x="44.7917" y="333.901">RunOnModule(module: HloModule*): StatusOr&lt;bool&gt;</text><ellipse cx="31.25" cy="348.818" fill="#84BE84" rx="3.125" ry="3.125" style="stroke:#038048;stroke-width:1.0416666666666667;"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="302.0833" x="44.7917" y="357.8125">DefaultAction(hlo_instruction: HloInstruction*): Status</text><text fill="#008080" font-family="&quot;Verdana&quot;" font-size="11.4583" font-weight="bold" lengthAdjust="spacing" textLength="48.9583" x="350" y="357.8125">override</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="4.1667" x="402.0833" y="357.8125">(</text><text fill="#FF0000" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="61.4583" x="406.25" y="357.8125">do nothing</text><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="4.1667" x="467.7083" y="357.8125">)</text><polygon fill="#FFFF44" points="31.25,367.5212,35.4167,371.6878,31.25,375.8545,27.0833,371.6878" style="stroke:#B38D22;stroke-width:1.0416666666666667;"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="663.5417" x="44.7917" y="381.724">ReplaceWithNewInstruction(old_instruction: HloInstruction*, new_instruction: std::unique_ptr&lt;HloInstruction&gt;): Status</text><polygon fill="#FFFF44" points="31.25,391.4327,35.4167,395.5994,31.25,399.766,27.0833,395.5994" style="stroke:#B38D22;stroke-width:1.0416666666666667;"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="517.7083" x="44.7917" y="405.6356">ReplaceInstruction(old_instruction: HloInstruction*, new_instruction: HloInstruction*): Status</text><!--MD5=[2345db810a8924848db2e850feae2330]
class AlgebraicSimplifierVisitor--><rect codeLine="74" height="720.518" id="AlgebraicSimplifierVisitor" rx="4.1667" ry="4.1667" style="stroke:#2FA4E7;stroke-width:1.0416666666666667;fill:none;" width="694.7917" x="22.3958" y="481.25"/><ellipse cx="289.5833" cy="498.4141" fill="#EDF0F2" rx="10.4167" ry="10.4167" style="stroke:#BABDBF;stroke-width:1.0416666666666667;"/><path d="M291.4937,502.8392 Q291.0665,503.0589 290.5965,503.1687 Q290.1265,503.2786 289.6077,503.2786 Q287.7645,503.2786 286.794,502.064 Q285.8236,500.8494 285.8236,498.5545 Q285.8236,496.2535 286.794,495.0389 Q287.7645,493.8243 289.6077,493.8243 Q290.1265,493.8243 290.6026,493.9341 Q291.0787,494.044 291.4937,494.2637 L291.4937,496.2657 Q291.0299,495.8384 290.5935,495.6401 Q290.1571,495.4417 289.6932,495.4417 Q288.7044,495.4417 288.2009,496.226 Q287.6973,497.0103 287.6973,498.5545 Q287.6973,500.0926 288.2009,500.8769 Q288.7044,501.6612 289.6932,501.6612 Q290.1571,501.6612 290.5935,501.4628 Q291.0299,501.2644 291.4937,500.8372 Z " fill="#000000"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="141.6667" x="314.5833" y="502.7445">AlgebraicSimplifierVisitor</text><line style="stroke:#2FA4E7;stroke-width:1.0416666666666667;" x1="23.4375" x2="716.1458" y1="515.5782" y2="515.5782"/><rect fill="none" height="6.25" style="stroke:#C82930;stroke-width:1.0416666666666667;" width="6.25" x="30.7292" y="523.9115"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="180.2083" x="47.3958" y="536.0311">computation_: HloComputation*</text><rect fill="none" height="6.25" style="stroke:#C82930;stroke-width:1.0416666666666667;" width="6.25" x="30.7292" y="547.8231"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="247.9167" x="47.3958" y="559.9426">options_: const AlgebraicSimplifierOptions&amp;</text><rect fill="none" height="6.25" style="stroke:#C82930;stroke-width:1.0416666666666667;" width="6.25" x="30.7292" y="571.7346"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="175" x="47.3958" y="583.8542">simplifier_: AlgebraicSimplifier*</text><rect fill="none" height="6.25" style="stroke:#C82930;stroke-width:1.0416666666666667;" width="6.25" x="30.7292" y="595.6462"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="463.5417" x="47.3958" y="607.7657">scalar_add_computations_: absl::flat_hash_map&lt;PrimitiveType, HloComputation*&gt;</text><line style="stroke:#2FA4E7;stroke-width:1.0416666666666667;" x1="23.4375" x2="716.1458" y1="619.5577" y2="619.5577"/><ellipse cx="33.8542" cy="631.016" fill="#84BE84" rx="3.125" ry="3.125" style="stroke:#038048;stroke-width:1.0416666666666667;"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="566.6667" x="47.3958" y="640.0106">AlgebraicSimplifierVisitor(options: const AlgebraicSimplifierOptions&amp;, simplifier: AlgebraicSimplifier*)</text><ellipse cx="33.8542" cy="654.9276" fill="#84BE84" rx="3.125" ry="3.125" style="stroke:#038048;stroke-width:1.0416666666666667;"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="658.3333" x="47.3958" y="663.9221">Run(computation: HloComputation*, options: const AlgebraicSimplifierOptions&amp;, simplifier: AlgebraicSimplifier*): bool</text><ellipse cx="33.8542" cy="678.8391" fill="#84BE84" rx="3.125" ry="3.125" style="stroke:#038048;stroke-width:1.0416666666666667;"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="220.8333" x="47.3958" y="687.8337">HandleAbs(abs: HloInstruction*): Status</text><text fill="#008080" font-family="&quot;Verdana&quot;" font-size="11.4583" font-weight="bold" lengthAdjust="spacing" textLength="48.9583" x="271.3542" y="687.8337">override</text><ellipse cx="33.8542" cy="702.7507" fill="#84BE84" rx="3.125" ry="3.125" style="stroke:#038048;stroke-width:1.0416666666666667;"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="222.9167" x="47.3958" y="711.7452">HandleAdd(add: HloInstruction*): Status</text><text fill="#008080" font-family="&quot;Verdana&quot;" font-size="11.4583" font-weight="bold" lengthAdjust="spacing" textLength="48.9583" x="273.4375" y="711.7452">override</text><ellipse cx="33.8542" cy="726.6622" fill="#84BE84" rx="3.125" ry="3.125" style="stroke:#038048;stroke-width:1.0416666666666667;"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="265.625" x="47.3958" y="735.6567">HandleAnd(logical_and: HloInstruction*): Status</text><text fill="#008080" font-family="&quot;Verdana&quot;" font-size="11.4583" font-weight="bold" lengthAdjust="spacing" textLength="48.9583" x="316.1458" y="735.6567">override</text><ellipse cx="33.8542" cy="750.5737" fill="#84BE84" rx="3.125" ry="3.125" style="stroke:#038048;stroke-width:1.0416666666666667;"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="290.625" x="47.3958" y="759.5683">HandleBroadcast(broadcast: HloInstruction*): Status</text><text fill="#008080" font-family="&quot;Verdana&quot;" font-size="11.4583" font-weight="bold" lengthAdjust="spacing" textLength="48.9583" x="341.1458" y="759.5683">override</text><ellipse cx="33.8542" cy="774.4853" fill="#84BE84" rx="3.125" ry="3.125" style="stroke:#038048;stroke-width:1.0416666666666667;"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="316.6667" x="47.3958" y="783.4798">HandleConcatenate(concatenate: HloInstruction*): Status</text><text fill="#008080" font-family="&quot;Verdana&quot;" font-size="11.4583" font-weight="bold" lengthAdjust="spacing" textLength="48.9583" x="367.1875" y="783.4798">override</text><ellipse cx="33.8542" cy="798.3968" fill="#84BE84" rx="3.125" ry="3.125" style="stroke:#038048;stroke-width:1.0416666666666667;"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="235.4167" x="47.3958" y="807.3914">HandleCopy(copy: HloInstruction*): Status</text><text fill="#008080" font-family="&quot;Verdana&quot;" font-size="11.4583" font-weight="bold" lengthAdjust="spacing" textLength="48.9583" x="285.9375" y="807.3914">override</text><ellipse cx="33.8542" cy="822.3083" fill="#84BE84" rx="3.125" ry="3.125" style="stroke:#038048;stroke-width:1.0416666666666667;"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="314.5833" x="47.3958" y="831.3029">HandleConvolution(convolution: HloInstruction*): Status</text><text fill="#008080" font-family="&quot;Verdana&quot;" font-size="11.4583" font-weight="bold" lengthAdjust="spacing" textLength="48.9583" x="365.1042" y="831.3029">override</text><ellipse cx="33.8542" cy="846.2199" fill="#84BE84" rx="3.125" ry="3.125" style="stroke:#038048;stroke-width:1.0416666666666667;"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="217.7083" x="47.3958" y="855.2144">HandleDot(dot: HloInstruction*): Status</text><text fill="#008080" font-family="&quot;Verdana&quot;" font-size="11.4583" font-weight="bold" lengthAdjust="spacing" textLength="48.9583" x="268.2292" y="855.2144">override</text><ellipse cx="33.8542" cy="870.1314" fill="#84BE84" rx="3.125" ry="3.125" style="stroke:#038048;stroke-width:1.0416666666666667;"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="270.8333" x="47.3958" y="879.126">HandleReshape(reshape: HloInstruction*): Status</text><text fill="#008080" font-family="&quot;Verdana&quot;" font-size="11.4583" font-weight="bold" lengthAdjust="spacing" textLength="48.9583" x="321.3542" y="879.126">override</text><ellipse cx="33.8542" cy="894.043" fill="#84BE84" rx="3.125" ry="3.125" style="stroke:#038048;stroke-width:1.0416666666666667;"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="237.5" x="47.3958" y="903.0375">HandleReduce(hlo: HloInstruction*): Status</text><text fill="#008080" font-family="&quot;Verdana&quot;" font-size="11.4583" font-weight="bold" lengthAdjust="spacing" textLength="48.9583" x="288.0208" y="903.0375">override</text><ellipse cx="33.8542" cy="917.9545" fill="#84BE84" rx="3.125" ry="3.125" style="stroke:#038048;stroke-width:1.0416666666666667;"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="229.1667" x="47.3958" y="926.9491">HandleSlice(slice: HloInstruction*): Status</text><text fill="#008080" font-family="&quot;Verdana&quot;" font-size="11.4583" font-weight="bold" lengthAdjust="spacing" textLength="48.9583" x="279.6875" y="926.9491">override</text><ellipse cx="33.8542" cy="941.866" fill="#84BE84" rx="3.125" ry="3.125" style="stroke:#038048;stroke-width:1.0416666666666667;"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="330.2083" x="47.3958" y="950.8606">HandleDynamicSlice(dynamic_slice: HloInstruction*): Status</text><text fill="#008080" font-family="&quot;Verdana&quot;" font-size="11.4583" font-weight="bold" lengthAdjust="spacing" textLength="48.9583" x="380.7292" y="950.8606">override</text><ellipse cx="33.8542" cy="965.7776" fill="#84BE84" rx="3.125" ry="3.125" style="stroke:#038048;stroke-width:1.0416666666666667;"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="243.75" x="47.3958" y="974.7721">HandleSelect(select: HloInstruction*): Status</text><text fill="#008080" font-family="&quot;Verdana&quot;" font-size="11.4583" font-weight="bold" lengthAdjust="spacing" textLength="48.9583" x="294.2708" y="974.7721">override</text><ellipse cx="33.8542" cy="989.6891" fill="#84BE84" rx="3.125" ry="3.125" style="stroke:#038048;stroke-width:1.0416666666666667;"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="225" x="47.3958" y="998.6837">HandleSort(sort: HloInstruction*): Status</text><text fill="#008080" font-family="&quot;Verdana&quot;" font-size="11.4583" font-weight="bold" lengthAdjust="spacing" textLength="48.9583" x="275.5208" y="998.6837">override</text><ellipse cx="33.8542" cy="1013.6007" fill="#84BE84" rx="3.125" ry="3.125" style="stroke:#038048;stroke-width:1.0416666666666667;"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="294.7917" x="47.3958" y="1022.5952">HandleTranspose(transpose: HloInstruction*): Status</text><text fill="#008080" font-family="&quot;Verdana&quot;" font-size="11.4583" font-weight="bold" lengthAdjust="spacing" textLength="48.9583" x="345.3125" y="1022.5952">override</text><ellipse cx="33.8542" cy="1037.5122" fill="#84BE84" rx="3.125" ry="3.125" style="stroke:#038048;stroke-width:1.0416666666666667;"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="18.75" x="47.3958" y="1046.5068">......</text><rect fill="#F24D5C" height="6.25" style="stroke:#C82930;stroke-width:1.0416666666666667;" width="6.25" x="30.7292" y="1058.2987"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="401.0417" x="47.3958" y="1070.4183">OptimizeDotOfConcat(dot: HloInstruction*): StatusOr&lt;HloInstruction*&gt;</text><rect fill="#F24D5C" height="6.25" style="stroke:#C82930;stroke-width:1.0416666666666667;" width="6.25" x="30.7292" y="1082.2103"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="367.7083" x="47.3958" y="1094.3298">FoldConvInputPad(convolution: HloInstruction*): StatusOr&lt;bool&gt;</text><rect fill="#F24D5C" height="6.25" style="stroke:#C82930;stroke-width:1.0416666666666667;" width="6.25" x="30.7292" y="1106.1218"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="366.6667" x="47.3958" y="1118.2414">FoldConvFilterPad(convolution: HloInstruction*): StatusOr&lt;bool&gt;</text><rect fill="#F24D5C" height="6.25" style="stroke:#C82930;stroke-width:1.0416666666666667;" width="6.25" x="30.7292" y="1130.0334"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="372.9167" x="47.3958" y="1142.1529">SimplifyConvToDot(convolution: HloInstruction*): StatusOr&lt;bool&gt;</text><rect fill="#F24D5C" height="6.25" style="stroke:#C82930;stroke-width:1.0416666666666667;" width="6.25" x="30.7292" y="1153.9449"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="396.875" x="47.3958" y="1166.0645">TryToReorderSliceAndReshape(slice: HloInstruction*): StatusOr&lt;bool&gt;</text><rect fill="#F24D5C" height="6.25" style="stroke:#C82930;stroke-width:1.0416666666666667;" width="6.25" x="30.7292" y="1177.8564"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="11.4583" lengthAdjust="spacing" textLength="18.75" x="47.3958" y="1189.976">......</text><!--MD5=[fc4558050a61724b189f92101a813a86]
reverse link AlgebraicSimplifier to AlgebraicSimplifierOptions--><path codeLine="105" d="M594.9375,1423.7188 C581.2292,1442.3958 566.0208,1463.1354 550.1667,1484.7708 " fill="none" id="AlgebraicSimplifier-backto-AlgebraicSimplifierOptions" style="stroke:#2FA4E7;stroke-width:3.125;"/><polygon fill="#2FA4E7" points="603.0417,1412.6667,595.9862,1415.2443,595.652,1422.7485,602.7074,1420.1708,603.0417,1412.6667" style="stroke:#2FA4E7;stroke-width:3.125;"/><!--MD5=[f9331aebbd99371b53a40b83dfee5269]
reverse link AlgebraicSimplifierVisitor to AlgebraicSimplifierOptions--><path codeLine="106" d="M369.7917,1216.0417 C369.7917,1303.6458 369.7917,1395.0104 369.7917,1476.0313 " fill="none" id="AlgebraicSimplifierVisitor-backto-AlgebraicSimplifierOptions" style="stroke:#2FA4E7;stroke-width:3.125;"/><polygon points="369.7917,1202.3021,365.625,1208.5521,369.7917,1214.8021,373.9583,1208.5521,369.7917,1202.3021" style="stroke:#2FA4E7;stroke-width:3.125;fill:none;"/><!--MD5=[73b0cbfd1b8e7ac24a104efe20a7b20a]
reverse link AlgebraicSimplifierVisitor to AlgebraicSimplifier--><path codeLine="107" d="M584.7083,1214.3229 C595.3854,1232.7813 605.3438,1250 614.2396,1265.3854 " fill="none" id="AlgebraicSimplifierVisitor-backto-AlgebraicSimplifier" style="stroke:#2FA4E7;stroke-width:3.125;"/><polygon points="577.7813,1202.3438,577.2982,1209.8398,584.0317,1213.1688,584.5148,1205.6728,577.7813,1202.3438" style="stroke:#2FA4E7;stroke-width:3.125;fill:none;"/><!--MD5=[017280b4de802315b98fce77201384cc]
reverse link DfsHloRewriteVisitor to AlgebraicSimplifierVisitor--><path codeLine="108" d="M369.7917,438.8438 C369.7917,452.1771 369.7917,466.3333 369.7917,481.0833 " fill="none" id="DfsHloRewriteVisitor-backto-AlgebraicSimplifierVisitor" style="stroke:#2FA4E7;stroke-width:3.125;"/><polygon fill="none" points="362.5,438.7917,369.7917,417.9583,377.0833,438.7917,362.5,438.7917" style="stroke:#2FA4E7;stroke-width:3.125;"/><!--MD5=[69a180bafc3bef72a2eec96f6914ec9a]
link AlgebraicSimplifierOptions to AlgebraicSimplifierOptions::Metadata--><path codeLine="109" d="M542.7083,1529.6875 C746.1771,1529.6875 633.4896,1805.9271 541.6667,1987.5 C522.6771,2025.0521 486.7813,2054.2813 452.6875,2075.1771 " fill="none" id="AlgebraicSimplifierOptions-to-AlgebraicSimplifierOptions::Metadata" style="stroke:#2FA4E7;stroke-width:3.125;stroke-dasharray:7.0,7.0;"/><polygon fill="#2FA4E7" points="448.1042,2077.9479,458.2869,2076.6974,452.5703,2075.2683,453.9994,2069.5516,448.1042,2077.9479" style="stroke:#2FA4E7;stroke-width:3.125;"/><text fill="#343A40" font-family="&quot;Verdana&quot;" font-size="13.5417" lengthAdjust="spacing" textLength="63.5417" x="525" y="2038.092">definition</text><!--MD5=[6922935cf66944a96a8ee337850dc6ee]
reverse link DfsHloVisitorWithDefaultBase to DfsHloRewriteVisitor--><path codeLine="110" d="M369.7917,204.7917 C369.7917,217.7188 369.7917,232.1979 369.7917,246.625 " fill="none" id="DfsHloVisitorWithDefaultBase-backto-DfsHloRewriteVisitor" style="stroke:#2FA4E7;stroke-width:3.125;"/><polygon fill="none" points="362.5,204.3854,369.7917,183.5521,377.0833,204.3854,362.5,204.3854" style="stroke:#2FA4E7;stroke-width:3.125;"/><!--MD5=[6bd35b402feab494697ebf7ffa18b60b]
reverse link DfsHloVisitorBase to DfsHloVisitorWithDefaultBase--><path codeLine="111" d="M369.7917,90.1979 C369.7917,104.5521 369.7917,119.8437 369.7917,132.1354 " fill="none" id="DfsHloVisitorBase-backto-DfsHloVisitorWithDefaultBase" style="stroke:#2FA4E7;stroke-width:3.125;"/><polygon fill="none" points="362.5,89.7917,369.7917,68.9583,377.0833,89.7917,362.5,89.7917" style="stroke:#2FA4E7;stroke-width:3.125;"/><!--MD5=[b06f8cd3ff34c0731c1084e201a73a76]
@startuml algebraic_simplifier
!theme cerulean-outline

class AlgebraicSimplifierOptions {
    - struct_Metadata
    - {field} reshape_is_bitcast_callback_: ReshapeIsBitcastCallback
    - {field} conv_is_lowerable_callback_: ConvIsLowerableCallback
    - {field} is_layout_sensitive_: bool
    - {field} enable_dot_strength_reduction_: bool
    - {field} enable_dot_to_multiply_rewrite_: bool
    - {field} enable_conv_simplification_: bool
    - {field} enable_conv_operand_swap_: bool
    - {field} enable_scalar_multiply_reduction_: bool
    - {field} enable_floats_are_real_: bool
    - {field} enable_window_reduce_to_reduce_replacement_: bool
    - {field} enable_reduce_of_reshape_: bool
    - {field} enable_negative_padding_replacement_: bool
    - {field} enable_sink_broadcast_: bool
    - {field} replace_transpose_with_bitcast_: bool
    - {field} very_small_gather_size_: int64_t
    - {field} minmax_propagate_nan_: bool
    - {field} metadata_: Metadata
    + {method} setter & getter of private fields above
}

class AlgebraicSimplifierOptions::Metadata {
  + cudnn_batchnorm_forward_training_metadata: std::string
}


class AlgebraicSimplifier {
    + AlgebraicSimplifier(options: const AlgebraicSimplifierOptions&)
    + Run(module: HloModule*): StatusOr<bool> <b><color:#008080>override</color></b>
    + CreateConstantWithLayoutUpdated(literal: Literal): std::unique_ptr<HloInstruction>
    # {field} options_: AlgebraicSimplifierOptions
}

Interface DfsHloVisitorBase

' Interface DfsHloVisitorBase {
'     + {method} HandleElementwiseUnary(hlo: HloInstruction*): Status (<color:Red>return unimplemented error</color>)
'     + {method} HandleElementwiseBinary(hlo: HloInstruction*): Status (<color:Red>return unimplemented error</color>)
'     + {method} HandleSqrt(hlo: HloInstruction*): Status
'     + {method} HandleMultiply(hlo: HloInstruction*): Status
'     + {abstract} HandleBatchNormTraining(hlo: HloInstruction*): Status
'     + {abstract} HandleDot(hlo: HloInstruction*): Status
'     + {abstract} HandleConvolution(hlo: HloInstruction*): Status
'     + {abstract} FinishVisit(hlo: HloInstruction*): Status
'     + {method} ......
' }
' DfsHloVisitorBase::HandleSqrt -[#green,dashed,thickness=1]-> DfsHloVisitorBase::HandleElementwiseUnary : call
' DfsHloVisitorBase::HandleMultiply -[#red,dotted,thickness=1]-> DfsHloVisitorBase::HandleElementwiseBinary

abstract class DfsHloVisitorWithDefaultBase

' abstract class DfsHloVisitorWithDefaultBase {
'     + {abstract} DefaultAction(hlo_instruction: HloInstruction*): Status
'     + {method} HandleElementwiseUnary: <b><color:#008080>override</color></b>
'     + {method} HandleElementwiseBinary: <b><color:#008080>override</color></b>
'     + {method} HandleBatchNormTraining: <b><color:#008080>override</color></b>
'     + {method} HandleDot: <b><color:#008080>override</color></b>
'     + {method} HandleConvolution: <b><color:#008080>override</color></b>
'     + {method} FinishVisit: <b><color:#008080>override</color></b>
'     + {method} ......
' }

class DfsHloRewriteVisitor {
    + {method} RunOnModule(module: HloModule*): StatusOr<bool>
    + {method} DefaultAction(hlo_instruction: HloInstruction*): Status <b><color:#008080>override</color></b> (<color:Red>do nothing</color>)
    # {method} ReplaceWithNewInstruction(old_instruction: HloInstruction*, new_instruction: std::unique_ptr<HloInstruction>): Status
    # {method} ReplaceInstruction(old_instruction: HloInstruction*, new_instruction: HloInstruction*): Status
    # {field} changed_: bool
}

class AlgebraicSimplifierVisitor {
  + {method} AlgebraicSimplifierVisitor(options: const AlgebraicSimplifierOptions&, simplifier: AlgebraicSimplifier*)
  + {method} Run(computation: HloComputation*, options: const AlgebraicSimplifierOptions&, simplifier: AlgebraicSimplifier*): bool
  + {method} HandleAbs(abs: HloInstruction*): Status <b><color:#008080>override</color></b>
  + {method} HandleAdd(add: HloInstruction*): Status <b><color:#008080>override</color></b>
  + {method} HandleAnd(logical_and: HloInstruction*): Status <b><color:#008080>override</color></b>
  + {method} HandleBroadcast(broadcast: HloInstruction*): Status <b><color:#008080>override</color></b>
  + {method} HandleConcatenate(concatenate: HloInstruction*): Status <b><color:#008080>override</color></b>
  + {method} HandleCopy(copy: HloInstruction*): Status <b><color:#008080>override</color></b>
  + {method} HandleConvolution(convolution: HloInstruction*): Status <b><color:#008080>override</color></b>
  + {method} HandleDot(dot: HloInstruction*): Status <b><color:#008080>override</color></b>
  + {method} HandleReshape(reshape: HloInstruction*): Status <b><color:#008080>override</color></b>
  + {method} HandleReduce(hlo: HloInstruction*): Status <b><color:#008080>override</color></b>
  + {method} HandleSlice(slice: HloInstruction*): Status <b><color:#008080>override</color></b>
  + {method} HandleDynamicSlice(dynamic_slice: HloInstruction*): Status <b><color:#008080>override</color></b>
  + {method} HandleSelect(select: HloInstruction*): Status <b><color:#008080>override</color></b>
  + {method} HandleSort(sort: HloInstruction*): Status <b><color:#008080>override</color></b>
  + {method} HandleTranspose(transpose: HloInstruction*): Status <b><color:#008080>override</color></b>
  + {method} ......
  - {method} OptimizeDotOfConcat(dot: HloInstruction*): StatusOr<HloInstruction*>
  - {method} FoldConvInputPad(convolution: HloInstruction*): StatusOr<bool>
  - {method} FoldConvFilterPad(convolution: HloInstruction*): StatusOr<bool>
  - {method} SimplifyConvToDot(convolution: HloInstruction*): StatusOr<bool>
  - {method} TryToReorderSliceAndReshape(slice: HloInstruction*): StatusOr<bool>
  - {method} ......
  - {field} computation_: HloComputation*
  - {field} options_: const AlgebraicSimplifierOptions&
  - {field} simplifier_: AlgebraicSimplifier*
  - {field} scalar_add_computations_: absl::flat_hash_map<PrimitiveType, HloComputation*>
}

AlgebraicSimplifier *- - AlgebraicSimplifierOptions
AlgebraicSimplifierVisitor o- - AlgebraicSimplifierOptions
AlgebraicSimplifierVisitor o- - AlgebraicSimplifier
DfsHloRewriteVisitor <|- - AlgebraicSimplifierVisitor
AlgebraicSimplifierOptions::struct_Metadata -[dashed]-> AlgebraicSimplifierOptions::Metadata  : definition
DfsHloVisitorWithDefaultBase <|- - DfsHloRewriteVisitor
DfsHloVisitorBase <|- - DfsHloVisitorWithDefaultBase
@enduml

@startuml algebraic_simplifier



skinparam backgroundColor transparent
skinparam useBetaStyle false






<style>
  root {
    BackgroundColor transparent
    FontColor #2FA4E7
    HyperLinkColor #FD7E14
    LineColor #2683B9
    LineThickness 1
    Margin 10
    Padding 6
    Shadowing 0.0
  }
  node {
   Padding 15
   roundcorner 20
   BackgroundColor transparent
  }
  caption {
    LineThickness 0
  }
  footer {
    LineThickness 0
  }
  groupHeader {
    BackgroundColor #E9ECEF
    FontColor #033C73
    FontStyle bold
  }
  header {
    LineThickness 0
  }
  referenceHeader {
    BackgroundColor transparent
    FontColor #343A40
    FontStyle bold
  }
  separator {
    BackgroundColor #343A40
    FontColor transparent
    FontStyle bold
  }
  title {
	FontSize 20
	BorderRoundCorner            8
	BorderThickness 	         1
	BackgroundColor  transparent
	FontColor #2FA4E7
	BorderColor #E9ECEF
  }
  nwdiagDiagram {
	network {
			FontColor #2FA4E7
	BorderColor #2FA4E7
	BackgroundColor transparent    
		LineColor #2FA4E7
		LineThickness 1.0
		FontColor #2683B9
	}
	server {
			FontColor #2FA4E7
	BorderColor #2FA4E7
	BackgroundColor transparent
	}
	arrow {
		FontColor #2683B9
		LineColor #2683B9
	}
	group {
		BackGroundColor #F8F9FA
		LineColor $LIGHT_DARK
		LineThickness 2.0
		Margin 5
		Padding 5
	}
  }
  ganttDiagram {
	task {
			FontColor #2FA4E7
	BorderColor #2FA4E7
	BackgroundColor transparent
		LineColor #2FA4E7
		Margin 10
		Padding 6
	}
	note {
		FontColor #033C73
		LineColor $INFO_DARK
		BackGroundColor transparent
	}
	separator {
		LineColor #BABDBF
		BackGroundColor transparent
		FontColor #BABDBF
	}
	milestone {
		FontColor #033C73
		FontSize 16
		FontStyle italic
		BackGroundColor #E9ECEF
		LineColor #BABDBF
	}
	timeline {
		BackgroundColor #E9ECEF
		FontColor #BABDBF
	}
	closed {
		BackgroundColor $WARNING_DARK
		FontColor #DD5600
	}
  }
</style>
skinparam defaultFontName       "Verdana"
skinparam defaultFontSize       12
skinparam dpi                   100
skinparam shadowing             false
skinparam roundcorner           8
skinparam ParticipantPadding    40
skinparam BoxPadding            40
skinparam Padding               5
skinparam ArrowColor            #868E96
skinparam stereotype {
    CBackgroundColor #EDF0F2
    CBorderColor #BABDBF
    ABackgroundColor #8FB961
    ABorderColor $SUCCESS_DARK
    IBackgroundColor #D2494E
    IBorderColor $DANGER_DARK
    EBackgroundColor #E47833
    EBorderColor $WARNING_DARK
    NBackgroundColor #35638F
    NBorderColor $INFO_DARK
}
skinparam title {
	FontColor	                 #2FA4E7
	BorderColor	                 #BABDBF
	FontSize	    	         20
	BorderRoundCorner            8
	BorderThickness 	         1
	BackgroundColor              transparent
}

skinparam legend {
	BackgroundColor transparent
	BorderColor #BABDBF
	FontColor #343A40
}

skinparam swimlane {
	BorderColor #033C73
	BorderThickness 2
	TitleBackgroundColor  #EDF0F2-#E9ECEF
	TitleFontColor #2FA4E7
}


skinparam activity {
		FontColor #2FA4E7
	BorderColor #2FA4E7
	BackgroundColor transparent
	BarColor #73A839
	StartColor #033C73
	EndColor #033C73
	DiamondBackgroundColor transparent
  	DiamondBorderColor #BABDBF
	DiamondFontColor #BABDBF
}


skinparam participant {
		FontColor #2FA4E7
	BorderColor #2FA4E7
	BackgroundColor transparent
	ParticipantBorderThickness 2
}


skinparam actor {
		FontColor #2FA4E7
	BorderColor #2FA4E7
	BackgroundColor transparent
}


skinparam arrow {
	Thickness 3
	Color #2FA4E7
	FontColor #343A40
}


skinparam sequence {
	BorderColor #2FA4E7
	TitleFontColor #2FA4E7
	BackgroundColor transparent
	StartColor #2FA4E7
	EndColor #2FA4E7
	BoxBackgroundColor transparent
	BoxBorderColor #868E96
	BoxFontColor #343A40
	DelayFontColor #343A40
	LifeLineBorderColor #BABDBF
	LifeLineBorderThickness 2
	LifeLineBackgroundColor transparent
	GroupBorderColor #868E96
	GroupFontColor #343A40
	GroupHeaderFontColor #033C73
	DividerBackgroundColor transparent
    DividerBorderColor #868E96
    DividerBorderThickness 2
    DividerFontColor #343A40
	ReferenceBackgroundColor transparent
	ReferenceBorderColor #868E96
	ReferenceFontColor #343A40
	ReferenceHeaderFontColor #033C73
	StereotypeFontColor #2FA4E7
}


skinparam partition {
	BorderColor #2FA4E7
	FontColor #2FA4E7
	BackgroundColor transparent
}


skinparam collections {
		FontColor #2FA4E7
	BorderColor #2FA4E7
	BackgroundColor transparent
}


skinparam control {
		FontColor #2FA4E7
	BorderColor #2FA4E7
	BackgroundColor transparent
}


skinparam entity {
		FontColor #2FA4E7
	BorderColor #2FA4E7
	BackgroundColor transparent
}


skinparam boundary {
		FontColor #2FA4E7
	BorderColor #2FA4E7
	BackgroundColor transparent
}


skinparam agent {
	BackgroundColor transparent
	BorderColor #999999
	FontColor #333333
}


skinparam note {
	BorderThickness 1
	BackgroundColor transparent
	BorderColor #033C73
	FontColor #033C73
}


skinparam artifact {
	BackgroundColor transparent
	BorderColor #868E96
	FontColor #868E96
}


skinparam component {
		FontColor #2FA4E7
	BorderColor #2FA4E7
	BackgroundColor transparent
}


skinparam interface {
	BackgroundColor  transparent
	BorderColor  #C71C22
	FontColor #343A40
}


skinparam storage {
	BackgroundColor transparent
  	BorderColor #DD5600
	FontColor #DD5600
}


skinparam node {
	BackgroundColor transparent
	BorderColor #343A40
	FontColor #343A40
}


skinparam cloud {
	BackgroundColor #F2FCFE-#eeeeee
	BorderColor #F2FCFE
	FontColor #343A40
}


skinparam database {
		FontColor #2FA4E7
	BorderColor #2FA4E7
	BackgroundColor transparent
}


skinparam class {
		FontColor #2FA4E7
	BorderColor #2FA4E7
	BackgroundColor transparent
	FontColor #F8F9FA
	HeaderBackgroundColor #2FA4E7-#2683B9
	StereotypeFontColor #343A40
	BorderThickness 1
	AttributeFontColor #343A40
	AttributeFontSize 11
}


skinparam object {
		FontColor #2FA4E7
	BorderColor #2FA4E7
	BackgroundColor transparent
	StereotypeFontColor #343A40
	BorderThickness 1
	AttributeFontColor #BABDBF
	AttributeFontSize 11
}


skinparam usecase {
		FontColor #2FA4E7
	BorderColor #2FA4E7
	BackgroundColor transparent
	BorderThickness 2
	StereotypeFontColor #2FA4E7
}


skinparam rectangle {
		FontColor #2FA4E7
	BorderColor #2FA4E7
	BackgroundColor transparent
	BorderThickness 2
	StereotypeFontColor #2FA4E7
}


skinparam package {
	BackgroundColor transparent
  	BorderColor #2FA4E7
	FontColor #2FA4E7
	BorderThickness 2
}


skinparam folder {
	BackgroundColor transparent
  	BorderColor #DD5600
	FontColor #DD5600
	BorderThickness 2
}


skinparam frame {
	BackgroundColor transparent
  	BorderColor #033C73
	FontColor #033C73
	BorderThickness 2
}


skinparam state {
		FontColor #2FA4E7
	BorderColor #2FA4E7
	BackgroundColor transparent
	StartColor #033C73
	EndColor #033C73
	AttributeFontColor #BABDBF
	AttributeFontSize 11
}


skinparam queue {
		FontColor #2FA4E7
	BorderColor #2FA4E7
	BackgroundColor transparent
}


skinparam card {
	BackgroundColor transparent
	BorderColor #033C73
	FontColor #033C73
}


skinparam file {
	BackgroundColor transparent
	BorderColor #868E96
	FontColor #868E96
}


skinparam stack {
		FontColor #2FA4E7
	BorderColor #2FA4E7
	BackgroundColor transparent
}




class AlgebraicSimplifierOptions {
    - struct_Metadata
    - {field} reshape_is_bitcast_callback_: ReshapeIsBitcastCallback
    - {field} conv_is_lowerable_callback_: ConvIsLowerableCallback
    - {field} is_layout_sensitive_: bool
    - {field} enable_dot_strength_reduction_: bool
    - {field} enable_dot_to_multiply_rewrite_: bool
    - {field} enable_conv_simplification_: bool
    - {field} enable_conv_operand_swap_: bool
    - {field} enable_scalar_multiply_reduction_: bool
    - {field} enable_floats_are_real_: bool
    - {field} enable_window_reduce_to_reduce_replacement_: bool
    - {field} enable_reduce_of_reshape_: bool
    - {field} enable_negative_padding_replacement_: bool
    - {field} enable_sink_broadcast_: bool
    - {field} replace_transpose_with_bitcast_: bool
    - {field} very_small_gather_size_: int64_t
    - {field} minmax_propagate_nan_: bool
    - {field} metadata_: Metadata
    + {method} setter & getter of private fields above
}

class AlgebraicSimplifierOptions::Metadata {
  + cudnn_batchnorm_forward_training_metadata: std::string
}


class AlgebraicSimplifier {
    + AlgebraicSimplifier(options: const AlgebraicSimplifierOptions&)
    + Run(module: HloModule*): StatusOr<bool> <b><color:#008080>override</color></b>
    + CreateConstantWithLayoutUpdated(literal: Literal): std::unique_ptr<HloInstruction>
    # {field} options_: AlgebraicSimplifierOptions
}

Interface DfsHloVisitorBase


abstract class DfsHloVisitorWithDefaultBase


class DfsHloRewriteVisitor {
    + {method} RunOnModule(module: HloModule*): StatusOr<bool>
    + {method} DefaultAction(hlo_instruction: HloInstruction*): Status <b><color:#008080>override</color></b> (<color:Red>do nothing</color>)
    # {method} ReplaceWithNewInstruction(old_instruction: HloInstruction*, new_instruction: std::unique_ptr<HloInstruction>): Status
    # {method} ReplaceInstruction(old_instruction: HloInstruction*, new_instruction: HloInstruction*): Status
    # {field} changed_: bool
}

class AlgebraicSimplifierVisitor {
  + {method} AlgebraicSimplifierVisitor(options: const AlgebraicSimplifierOptions&, simplifier: AlgebraicSimplifier*)
  + {method} Run(computation: HloComputation*, options: const AlgebraicSimplifierOptions&, simplifier: AlgebraicSimplifier*): bool
  + {method} HandleAbs(abs: HloInstruction*): Status <b><color:#008080>override</color></b>
  + {method} HandleAdd(add: HloInstruction*): Status <b><color:#008080>override</color></b>
  + {method} HandleAnd(logical_and: HloInstruction*): Status <b><color:#008080>override</color></b>
  + {method} HandleBroadcast(broadcast: HloInstruction*): Status <b><color:#008080>override</color></b>
  + {method} HandleConcatenate(concatenate: HloInstruction*): Status <b><color:#008080>override</color></b>
  + {method} HandleCopy(copy: HloInstruction*): Status <b><color:#008080>override</color></b>
  + {method} HandleConvolution(convolution: HloInstruction*): Status <b><color:#008080>override</color></b>
  + {method} HandleDot(dot: HloInstruction*): Status <b><color:#008080>override</color></b>
  + {method} HandleReshape(reshape: HloInstruction*): Status <b><color:#008080>override</color></b>
  + {method} HandleReduce(hlo: HloInstruction*): Status <b><color:#008080>override</color></b>
  + {method} HandleSlice(slice: HloInstruction*): Status <b><color:#008080>override</color></b>
  + {method} HandleDynamicSlice(dynamic_slice: HloInstruction*): Status <b><color:#008080>override</color></b>
  + {method} HandleSelect(select: HloInstruction*): Status <b><color:#008080>override</color></b>
  + {method} HandleSort(sort: HloInstruction*): Status <b><color:#008080>override</color></b>
  + {method} HandleTranspose(transpose: HloInstruction*): Status <b><color:#008080>override</color></b>
  + {method} ......
  - {method} OptimizeDotOfConcat(dot: HloInstruction*): StatusOr<HloInstruction*>
  - {method} FoldConvInputPad(convolution: HloInstruction*): StatusOr<bool>
  - {method} FoldConvFilterPad(convolution: HloInstruction*): StatusOr<bool>
  - {method} SimplifyConvToDot(convolution: HloInstruction*): StatusOr<bool>
  - {method} TryToReorderSliceAndReshape(slice: HloInstruction*): StatusOr<bool>
  - {method} ......
  - {field} computation_: HloComputation*
  - {field} options_: const AlgebraicSimplifierOptions&
  - {field} simplifier_: AlgebraicSimplifier*
  - {field} scalar_add_computations_: absl::flat_hash_map<PrimitiveType, HloComputation*>
}

AlgebraicSimplifier *- - AlgebraicSimplifierOptions
AlgebraicSimplifierVisitor o- - AlgebraicSimplifierOptions
AlgebraicSimplifierVisitor o- - AlgebraicSimplifier
DfsHloRewriteVisitor <|- - AlgebraicSimplifierVisitor
AlgebraicSimplifierOptions::struct_Metadata -[dashed]-> AlgebraicSimplifierOptions::Metadata  : definition
DfsHloVisitorWithDefaultBase <|- - DfsHloRewriteVisitor
DfsHloVisitorBase <|- - DfsHloVisitorWithDefaultBase
@enduml

PlantUML version 1.2021.16(Thu Dec 09 01:25:22 CST 2021)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: zh
Country: CN
--></g></svg>